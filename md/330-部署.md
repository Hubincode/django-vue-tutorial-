

```python
# 本机命令行
# 路径位于 frontend 目录
D:\...\frontend> npm run build
```

多出个 dist 目录



```python
# drf_vue_blog/settings.py

...

# 修改项。关闭调试模式
DEBUG = False

# 修改项。允许的服务器
ALLOWED_HOSTS = ['*']

# 修改项。需要收集的静态文件的位置
STATICFILES_DIRS = [
    os.path.join(BASE_DIR, "frontend/dist/"),
]

# 新增项。静态文件收集目录
STATIC_ROOT = os.path.join(BASE_DIR, 'collected_static')
```



```python
(venv) > pip freeze > requirements.txt
```





记得上传到 github

```python
# 去掉各级 .ignore 里的 /dist 
# /dist

# 另外，注意前后端所有用到的库都不要上传，比如 venv 目录和 node_modules 目录
```







```python
Connecting to xxx...
...
Welcome to Ubuntu 20.04.1 LTS (GNU/Linux 5.4.0-58-generic x86_64)

 * Documentation:  https://help.ubuntu.com
 * Management:     https://landscape.canonical.com
 * Support:        https://ubuntu.com/advantage

Welcome to Alibaba Cloud Elastic Compute Service !
```





```python
~$ apt-get update
~$ apt-get upgrade

~$ apt-get install nginx
~$ apt-get install python3
~$ apt-get install python3-pip
~$ apt-get install git
~$ pip3 install virtualenv

~$ mkdir -p /home/sites/myblog
~$ cd /home/sites/myblog
../myblog$

# 密码下载可能会废弃
../myblog$ git clone https://github.com/stacklens/django-vue-tutorial.git

../myblog$ virtualenv --python=3.8 venv
../myblog$ source venv/bin/activate
# 看到 (venv) 开头就对了
(venv) ../myblog$ 

(venv) ../myblog$ cd django-vue-tutorial
(venv) ../django-vue-tutorial$

(venv) ../django_vue_tutorial$ pip3 install -r requirements.txt
(venv) ../django_vue_tutorial$ python3 manage.py collectstatic
(venv) ../django_vue_tutorial$ python3 manage.py migrate

# 省略 $ 前面的路径部分
(env) ~$ service nginx start
```



![]()

> nginx 启动页面



```python
(env) ~$ vim /etc/nginx/sites-available/myblog
```



```python
# nginx config

server {
  charset utf-8;
  listen 80;
  server_name 114.215.169.69;  # 改成你的 IP

  root /home/sites/myblog/django-vue-tutorial;

  location /static {
    alias /home/sites/myblog/django-vue-tutorial/collected_static;
  }

  location /media {
    alias /home/sites/myblog/django-vue-tutorial/media;
  }

  location /js {
    alias /home/sites/myblog/django-vue-tutorial/collected_static/js;
  }

  location /css {
    alias /home/sites/myblog/django-vue-tutorial/collected_static/css;
  }

  location /api {
    proxy_set_header Host $host;
    proxy_pass http://unix:/tmp/114.215.169.69.socket;  # 改成你的 IP
  }

  location / {
    try_files /collected_static/index.html =404;
  }
}
```



```python

ln -s /etc/nginx/sites-available/myblog /etc/nginx/sites-enabled

pip3 install gunicorn
service nginx restart
gunicorn --bind unix:/tmp/114.215.169.69.socket drf_vue_blog.wsgi:application
```



